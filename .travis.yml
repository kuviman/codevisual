language: rust
install:
  - >-
    curl -O
    https://s3.amazonaws.com/mozilla-games/emscripten/releases/emsdk-portable.tar.gz
  - tar -xzf emsdk-portable.tar.gz
  - source emsdk_portable/emsdk_env.sh
  - emsdk update
  - emsdk install latest
  - emsdk activate latest
  - sudo apt install libasound2-dev
  - rustup target add wasm32-unknown-emscripten
script:
  - cargo test --verbose --package codevisual
  - >-
    cargo build --package codevisual --examples --target
    wasm32-unknown-emscripten
before_deploy:
  - cargo doc --no-deps --package codevisual
  - >-
    echo '<meta http-equiv=refresh content=0;url=codevisual/index.html>' >
    target/doc/index.html
deploy:
  provider: pages
  skip-cleanup: true
  github-token: $TOKEN
  keep-history: true
  local-dir: target/doc
  on:
    branch: master
